<h2 mat-dialog-title class="text-center text-2xl">Confirmar Pago</h2>

<mat-dialog-content class="flex flex-col gap-4">
    <!-- Resumen de la nota -->
    <div class="border rounded p-3">
        <div class="font-semibold mb-2">Nota seleccionada</div>
        <table class="w-full text-sm">
            <tbody>
                <tr>
                    <td class="py-1 font-medium">ID Nota</td>
                    <td class="py-1 text-right">#{{ data.entryId }}</td>
                </tr>
                <tr>
                    <td class="py-1 font-medium">Proveedor</td>
                    <td class="py-1 text-right">{{ data.businessName }}</td>
                </tr>
                <tr>
                    <td class="py-1 font-medium"># Factura</td>
                    <td class="py-1 text-right">{{ data.invoiceNumber || '-' }}</td>
                </tr>
                <tr>
                    <td class="py-1 font-medium">Total</td>
                    <td class="py-1 text-right">{{ data.totalAmount | currency:'MXN' }}</td>
                </tr>
                <tr>
                    <td class="py-1 font-medium">Saldo a pagar</td>
                    <td class="py-1 text-right">{{ data.amountPending | currency:'MXN' }}</td>
                </tr>
            </tbody>
        </table>
    </div>

    <form [formGroup]="form" class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
        <!-- Monto -->
        <mat-form-field appearance="fill">
            <mat-label>Monto</mat-label>
            <input matInput type="number" min="0.01" step="0.01" formControlName="amount" />
            <mat-error *ngIf="isValidField('amount')">Monto es requerido y debe ser mayor a 0.</mat-error>
            <mat-error *ngIf="form.get('amount')?.hasError('exceedPending')">
                El monto no puede exceder el saldo a pagar ({{ data.amountPending | currency:'MXN' }}).
            </mat-error>
        </mat-form-field>

        <!-- Método de pago -->
        <mat-form-field appearance="fill">
            <mat-label>Método de pago</mat-label>
            <mat-select formControlName="method">
                <mat-option *ngFor="let m of data.paymentMethods" [value]="m.value">
                    {{ m.label }}
                </mat-option>
            </mat-select>
            <mat-error *ngIf="isValidField('method')">Método de pago es requerido.</mat-error>
        </mat-form-field>

        <!-- Comentarios (ocupa 2 columnas) -->
        <mat-form-field appearance="fill" class="md:col-span-2">
            <mat-label>Comentarios</mat-label>
            <textarea matInput rows="3" formControlName="comments"></textarea>
            <mat-error *ngIf="isValidField('comments')">Comentarios es requerido.</mat-error>
        </mat-form-field>
    </form>

    <mat-progress-bar *ngIf="loading" mode="indeterminate"></mat-progress-bar>
</mat-dialog-content>

<mat-dialog-actions align="center">
    <button mat-raised-button class="btn-success h-10" (click)="aplicar()" [disabled]="loading">
        Aplicar
    </button>
    <button mat-button class="btn-cancel ml-2 h-10" (click)="cancelar()" [disabled]="loading">
        Cancelar
    </button>
</mat-dialog-actions>